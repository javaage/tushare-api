# coding:utf8

import tushare as ts
import pandas as pd

def calIndexDelta(indexCode):
    ts.set_token('ded567c8b305a3ed36fb2b12b15ca0209a9d93f5880be42822234fa6')

    pro = ts.pro_api()
    df_base = pro.index_daily(ts_code='399001.SZ')
    df_compare = pro.index_daily(ts_code=indexCode)

    df_base_slice = df_base[['trade_date', 'close']]
    df_compare_slice = df_compare[['trade_date', 'close']]

    weight_base = df_base_slice[['close']].apply(lambda x: x.max() + x.min())
    weight_compare = df_compare_slice[['close']].apply(lambda x: x.max() + x.min())
    factor = weight_base.values[0] / weight_compare.values[0]

    df_compare_slice = df_compare_slice.assign(close=lambda x: x.close * factor)

    dfNew = pd.merge(df_base_slice, df_compare_slice, how='inner', on='trade_date')

    dfNew.eval('delta=close_y-close_x', inplace=True)

    return dfNew[['trade_date', 'close_x', 'delta']].values.tolist()

indexList = [['000001.SH','上证综指'],['000002.SH','上证A指'],['000003.SH','上证B指'],['000004.SH','上证工业类指数'],['000005.SH','上证商业类指数'],['000006.SH','上证房地产指数'],['000007.SH','上证公用事业股指数'],['000008.SH','上证综合股指数'],['000009.SH','上证380'],['000010.SH','上证180'],['000015.SH','上证红利'],['000016.SH','上证50'],['000017.SH','新综指'],['000018.SH','180金融'],['000019.SH','治理指数'],['000020.SH','中型综指'],['000021.SH','180治理'],['000025.SH','180基建'],['000026.SH','180资源'],['000027.SH','180运输'],['000028.SH','180成长'],['000029.SH','180价值'],['000030.SH','180R成长'],['000031.SH','180R价值'],['000032.SH','上证能源'],['000033.SH','上证材料'],['000034.SH','上证工业'],['000035.SH','上证可选'],['000036.SH','上证消费'],['000037.SH','上证医药'],['000038.SH','上证金融'],['000039.SH','上证信息'],['000040.SH','上证电信'],['000041.SH','上证公用'],['000042.SH','上证央企'],['000043.SH','超大盘'],['000044.SH','上证中盘'],['000045.SH','上证小盘'],['000046.SH','上证中小'],['000047.SH','上证全指'],['000048.SH','责任指数'],['000049.SH','上证民企'],['000050.SH','50等权'],['000051.SH','180等权'],['000052.SH','50基本'],['000053.SH','180基本'],['000054.SH','上证海外'],['000055.SH','上证地企'],['000056.SH','上证国企'],['000057.SH','全指成长'],['000058.SH','全指价值'],['000059.SH','全R成长'],['000060.SH','全R价值'],['000062.SH','上证沪企'],['000063.SH','上证周期'],['000064.SH','非周期'],['000065.SH','上证龙头'],['000066.SH','上证商品'],['000067.SH','上证新兴'],['000068.SH','上证资源'],['000069.SH','消费80'],['000070.SH','能源等权'],['000071.SH','材料等权'],['000072.SH','工业等权'],['000073.SH','可选等权'],['000074.SH','消费等权'],['000075.SH','医药等权'],['000076.SH','金融等权'],['000077.SH','信息等权'],['000078.SH','电信等权'],['000079.SH','公用等权'],['000090.SH','上证流通'],['000091.SH','沪财中小'],['000092.SH','资源50'],['000093.SH','180分层'],['000094.SH','上证上游'],['000095.SH','上证中游'],['000096.SH','上证下游'],['000097.SH','高端装备'],['000098.SH','上证F200'],['000099.SH','上证F300'],['000100.SH','上证F500'],['000102.SH','沪投资品'],['000103.SH','沪消费品'],['000104.SH','380能源'],['000105.SH','380材料'],['000106.SH','380工业'],['000107.SH','380可选'],['000108.SH','380消费'],['000109.SH','380医药'],['000110.SH','380金融'],['000111.SH','380信息'],['000112.SH','380电信'],['000113.SH','380公用'],['000114.SH','持续产业'],['000115.SH','380等权'],['000117.SH','380成长'],['000118.SH','380价值'],['000119.SH','380R成长'],['000120.SH','380R价值'],['000121.SH','医药主题'],['000122.SH','农业主题'],['000123.SH','上证180动态'],['000125.SH','上证180稳定'],['000126.SH','上证消费50'],['000128.SH','380基本'],['000129.SH','180波动'],['000130.SH','380波动'],['000131.SH','上证高新'],['000132.SH','上证100'],['000133.SH','上证150'],['000134.SH','上证银行'],['000135.SH','上证180高贝塔'],['000136.SH','上证180低贝塔'],['000137.SH','上证380高贝塔'],['000138.SH','上证380低贝塔'],['000141.SH','上证380动态'],['000142.SH','上证380稳定'],['000145.SH','优势资源'],['000146.SH','优势制造'],['000147.SH','优势消费'],['000148.SH','消费领先'],['000149.SH','上证180红利'],['000150.SH','上证380红利'],['000151.SH','上证国企红利'],['000152.SH','上证央企红利'],['000153.SH','上证民企红利'],['000155.SH','上证市值百强'],['000158.SH','上证环保'],['000159.SH','沪股通'],['000160.SH','沪新丝路'],['000802.SH','500沪市'],['000849.SH','300非银'],['000850.SH','300有色'],['000901.SH','小康指数'],['000970.SH','ESG.SH','40'],['000972.SH','300沪市'],['000976.SH','新华金牛'],['000999.SH','两岸三地'],['399001','深证成指'],['399002','深成指R'],['399003','深成B指'],['399004','深证100R'],['399005','中小板指'],['399006','创业板指'],['399007','深证300'],['399008','中小300'],['399009','深证200'],['399010','深证700'],['399011','深证1000'],['399012','创业300'],['399013','深市精选'],['399015','中小创新'],['399100','深证新综指'],['399101','中小板综'],['399102','创业板综'],['399106','深证综指'],['399107','深证A指'],['399108','深证B指'],['399231','农林指数'],['399232','采矿指数'],['399233','制造指数'],['399234','水电指数'],['399235','建筑指数'],['399236','批零指数'],['399237','运输指数'],['399238','餐饮指数'],['399239','IT指数'],['399240','金融指数'],['399241','地产指数'],['399242','商务指数'],['399243','科研指数'],['399244','公共指数'],['399248','文化指数'],['399249','综企指数'],['399300','沪深300'],['399303','国证2000'],['399310','国证50'],['399311','国证1000'],['399312','国证300'],['399313','巨潮100'],['399314','巨潮大盘'],['399315','巨潮中盘'],['399316','巨潮小盘'],['399317','国证A指'],['399318','国证B指'],['399319','资源优势'],['399320','国证服务'],['399321','国证红利'],['399322','国证治理'],['399324','深证红利'],['399326','成长40'],['399328','深证治理'],['399330','深证100'],['399332','深证创新'],['399333','中小板指R'],['399335','深证央企'],['399337','深证民营'],['399339','深证科技'],['399341','深证责任'],['399344','深证300R'],['399346','深证成长'],['399348','深证价值'],['399350','皖江30'],['399351','深圳报业指数'],['399352','深报综指'],['399353','国证物流'],['399354','分析师指数'],['399355','CBN长江'],['399356','CBN珠江'],['399357','CBN渤海'],['399358','泰达环保指数'],['399359','国证基建'],['399360','国证装备'],['399361','国证商业'],['399362','国证民营'],['399363','计算机指'],['399364','中金消费'],['399365','国证农业'],['399366','国证大宗'],['399367','巨潮地产'],['399368','国证军工'],['399369','CBN-兴全'],['399370','国证成长'],['399371','国证价值'],['399372','大盘成长'],['399373','大盘价值'],['399374','中盘成长'],['399375','中盘价值'],['399376','小盘成长'],['399377','小盘价值'],['399378','南方低碳'],['399381','1000能源'],['399382','1000材料'],['399383','1000工业'],['399384','1000可选'],['399385','1000消费'],['399386','1000医药'],['399387','1000金融'],['399388','1000信息'],['399389','国证通信'],['399390','1000公用'],['399391','投资时钟'],['399392','国证新兴'],['399393','国证地产'],['399394','国证医药'],['399395','国证有色'],['399396','国证食品'],['399397','OCT文化'],['399398','绩效指数'],['399399','中经GDP'],['399400','大中盘'],['399401','中小盘'],['399402','周期100'],['399403','防御100'],['399404','大盘低波'],['399405','大盘高贝'],['399406','中盘低波'],['399407','中盘高贝'],['399408','小盘低波'],['399409','小盘高贝'],['399410','苏州率先'],['399411','红利100'],['399412','国证新能'],['399415','I100'],['399416','I300'],['399417','新能源车'],['399418','国证国安'],['399419','国证高铁'],['399420','国证保证'],['399423','中关村50'],['399427','专利领先'],['399428','国证定增'],['399429','新丝路'],['399431','国证银行'],['399432','国证汽车'],['399433','国证交运'],['399434','国证传媒'],['399435','国证农牧'],['399436','国证煤炭'],['399437','国证证券'],['399438','国证电力'],['399439','国证油气'],['399440','国证钢铁'],['399441','生物医药'],['399550','央视50'],['399551','央视创新'],['399552','央视成长'],['399553','央视回报'],['399554','央视治理'],['399555','央视责任'],['399556','央视生态'],['399557','央视文化'],['399602','中小成长'],['399604','中小价值'],['399606','创业板指R'],['399608','科技100'],['399610','TMT50'],['399611','中创100R'],['399612','中创100'],['399613','深证能源'],['399614','深证材料'],['399615','深证工业'],['399616','深证可选'],['399617','深证消费'],['399618','深证医药'],['399619','深证金融'],['399620','深证信息'],['399621','深证电信'],['399622','深证公用'],['399623','中小基础'],['399624','中创400'],['399625','中创500'],['399626','中创500成长'],['399627','中创500价值'],['399628','700成长'],['399629','700价值'],['399630','1000成长'],['399631','1000价值'],['399632','深100EW'],['399633','深300EW'],['399634','中小板EW'],['399635','创业板EW'],['399636','深证装备'],['399637','深证地产'],['399638','深证环保'],['399639','深证大宗'],['399640','创业基础'],['399641','深证新兴'],['399642','中小新兴'],['399643','创业新兴'],['399644','深证时钟'],['399645','100低波'],['399646','深消费50'],['399647','深医药50'],['399648','深证GDP100'],['399649','中小板红利'],['399650','中小板治理'],['399651','中小板责任'],['399652','中创高新'],['399653','深证龙头'],['399654','深证文化'],['399655','深证绩效'],['399656','100绩效'],['399657','300绩效'],['399658','中小绩效'],['399659','深成指EW'],['399660','中创EW'],['399661','深证低波'],['399662','深证高贝'],['399663','中小低波'],['399664','中小高贝'],['399665','中创低波'],['399666','中创高贝'],['399667','创业板G'],['399668','创业板V'],['399669','深证农业'],['399670','深周期50'],['399671','深防御50'],['399672','深红利50'],['399673','创业板50'],['399674','深A医药'],['399675','深互联网'],['399676','深医药EW'],['399677','深互联EW'],['399678','深次新股'],['399679','深证200R'],['399701','深证F60'],['399702','深证F120'],['399703','深证F200'],['399704','深证上游'],['399705','深证中游'],['399706','深证下游'],['399802','500深市'],['399901','小康指数'],['399908','沪深300能源'],['399909','沪深300材料'],['399910','沪深300工业'],['399911','沪深300可选'],['399912','沪深300消费'],['399913','沪深300医药'],['399914','沪深300金融'],['399915','沪深300信息'],['399916','沪深300电信'],['399917','沪深300公用'],['399918','沪深300成长'],['399919','沪深300价值'],['399920','沪深300R成长'],['399925','基本面50'],['399927','央企100'],['399939','民企200'],['399941','新能源'],['399942','内地消费'],['399943','内地基建'],['399944','内地资源'],['399945','内地运输'],['399946','内地金融'],['399947','内地银行'],['399948','内地地产'],['399949','内地农业'],['399950','300基建'],['399951','300银行'],['399952','300地产'],['399954','地企100'],['399956','国企200'],['399957','300运输'],['399958','创业成长'],['399968','300周期'],['399969','300非周'],['399972','300深市'],['399977','内地低碳'],['399978','医药100'],['399979','大宗商品'],['399982','500等权']];

